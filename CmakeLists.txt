cmake_minimum_required(VERSION 3.30)

# c++ 17 is required
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# Set project name
project(GameEngine)

# Get dependencies
set(FETCHCONTENT_BASE_DIR ${CMAKE_BINARY_DIR}/_deps CACHE PATH "Dependencies download dir")
include(FetchContent)
set(FETCHCONTENT_QUIET OFF)

# VK-Boostrap
include(FetchContent)
FetchContent_Declare(
    vk_bootstrap
    GIT_REPOSITORY https://github.com/charles-lunarg/vk-bootstrap
    GIT_TAG v1.3.290
    GIT_SHALLOW TRUE
)

FetchContent_MakeAvailable(vk_bootstrap)
FetchContent_GetProperties(vk_bootstrap)
if(NOT vk_bootstrap_POPULATED)
    FetchContent_Populate(vk_bootstrap)
    add_subdirectory(${vk_bootstrap_SOURCE_DIR} ${vk_bootstrap_BINARY_DIR} EXCLUDE_FROM_ALL)
endif()

# SDL 3

set(SDL_SHARED OFF CACHE BOOL "" FORCE)
set(SDL_STATIC ON CACHE BOOL "" FORCE)

include(FetchContent)
FetchContent_Declare(
  SDL3
  GIT_REPOSITORY https://github.com/libsdl-org/SDL.git
  GIT_TAG release-3.2.22
  GIT_SHALLOW TRUE  
)

FetchContent_MakeAvailable(SDL3)
FetchContent_GetProperties(SDL3)

# YAML-CPP
#if(WIN32 AND NOT MINGW)
#  FetchContent_Declare
#endif()

file(GLOB SOURCES
    Main.cpp
    #Engine/*.cpp
    #Render/CommandBuffer/*cpp
    #Render/CommandPool/*cpp
    ${vk_bootstrap_SOURCE_DIR}/*.cpp
)

add_executable(${PROJECT_NAME} ${SOURCES})

target_include_directories(${PROJECT_NAME} PRIVATE
    ${vk_bootstrap_SOURCE_DIR}/src
)

if(MSVC)
  target_link_libraries(${PROJECT_NAME} PRIVATE vk-bootstrap SDL3-static)
else()
  # Clang and GCC may need libstd++ and libmath
  target_link_libraries(${PROJECT_NAME} PRIVATE vk-bootstrap::vk-bootstrap stdc++ m)
endif()
